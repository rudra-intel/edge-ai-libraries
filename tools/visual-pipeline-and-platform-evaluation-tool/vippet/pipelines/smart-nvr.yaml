name: Smart NVR
definition: >
  This pipeline processes video streams with AI-based analytics including object detection, tracking,
  and classification. Outputs include video recording, metadata, and processed video frames.
tags:
  - Smart Cities
thumbnail: images/smart-nvr.png
variants:
  - name: CPU
    pipeline_description: >-
      filesrc location=/videos/input/people.mp4 !
      parsebin !
      tee name=t0 !
      queue !
      splitmuxsink location=/tmp/people-output.mp4
      t0. !
      queue !
      avdec_h264 !
      video/x-raw !
      gvafpscounter starting-frame=100 !
      gvadetect
        model=/models/output/pipeline-zoo-models/yolov5s-416_INT8/FP16-INT8/yolov5s.xml
        model-proc=/models/output/pipeline-zoo-models/yolov5s-416_INT8/yolo-v5.json
        model-instance-id=detect0
        pre-process-backend=opencv
        device=CPU
        batch-size=0
        inference-interval=3
        nireq=0 !
      queue !
      gvatrack tracking-type=short-term-imageless !
      queue !
      gvaclassify
        model=/models/output/pipeline-zoo-models/resnet-50-tf_INT8/resnet-50-tf_i8.xml
        model-proc=/models/output/pipeline-zoo-models/resnet-50-tf_INT8/resnet-50-tf_i8.json
        model-instance-id=classify0
        pre-process-backend=opencv
        device=CPU
        batch-size=0
        inference-interval=3
        nireq=0
        inference-region=roi-list
        reclassify-interval=1 !
      queue !
      gvawatermark !
      gvametaconvert format=json json-indent=4 !
      gvametapublish method=file file-path=/dev/null !
      videoscale !
      video/x-raw,width=320,height=240 !
      fakesink name=default_output_sink
  - name: GPU
    pipeline_description: >-
      filesrc location=/videos/input/people.mp4 !
      parsebin !
      tee name=t0 !
      queue !
      splitmuxsink location=/tmp/people-output.mp4
      t0. !
      queue !
      vah264dec !
      video/x-raw(memory:VAMemory) !
      gvafpscounter starting-frame=100 !
      gvadetect
        model=/models/output/pipeline-zoo-models/yolov5s-416_INT8/FP16-INT8/yolov5s.xml
        model-proc=/models/output/pipeline-zoo-models/yolov5s-416_INT8/yolo-v5.json
        model-instance-id=detect0
        pre-process-backend=va-surface-sharing
        device=GPU
        batch-size=0
        inference-interval=3
        nireq=0 !
      queue !
      gvatrack tracking-type=short-term-imageless !
      queue !
      gvaclassify
        model=/models/output/pipeline-zoo-models/resnet-50-tf_INT8/resnet-50-tf_i8.xml
        model-proc=/models/output/pipeline-zoo-models/resnet-50-tf_INT8/resnet-50-tf_i8.json
        model-instance-id=classify0
        pre-process-backend=va-surface-sharing
        device=GPU
        batch-size=0
        inference-interval=3
        nireq=0
        inference-region=roi-list
        reclassify-interval=1 !
      queue !
      gvawatermark !
      gvametaconvert format=json json-indent=4 !
      gvametapublish method=file file-path=/dev/null !
      vapostproc !
      video/x-raw(memory:VAMemory),width=320,height=240 !
      fakesink name=default_output_sink
  - name: NPU
    pipeline_description: >-
      filesrc location=/videos/input/people.mp4 !
      parsebin !
      tee name=t0 !
      queue !
      splitmuxsink location=/tmp/people-output.mp4
      t0. !
      queue !
      vah264dec !
      vapostproc !
      video/x-raw\(memory:VAMemory\) !
      gvafpscounter starting-frame=100 !
      gvadetect
        model=/models/output/pipeline-zoo-models/yolov5s-416_INT8/FP16-INT8/yolov5s.xml
        model-proc=/models/output/pipeline-zoo-models/yolov5s-416_INT8/yolo-v5.json
        model-instance-id=detect0
        pre-process-backend=va
        device=NPU
        batch-size=0
        inference-interval=3
        nireq=0 !
      queue !
      gvatrack tracking-type=short-term-imageless !
      queue !
      gvaclassify
        model=/models/output/pipeline-zoo-models/resnet-50-tf_INT8/resnet-50-tf_i8.xml
        model-proc=/models/output/pipeline-zoo-models/resnet-50-tf_INT8/resnet-50-tf_i8.json
        model-instance-id=classify0
        pre-process-backend=va
        device=NPU
        batch-size=0
        inference-interval=3
        nireq=0
        inference-region=roi-list
        reclassify-interval=1 !
      queue !
      gvawatermark !
      gvametaconvert format=json json-indent=4 !
      gvametapublish method=file file-path=/dev/null !
      vapostproc !
      video/x-raw(memory:VAMemory),width=320,height=240 !
      fakesink name=default_output_sink
  - name: GPU_NPU
    pipeline_description: >-
      filesrc location=/videos/input/people.mp4 !
      parsebin !
      tee name=t0 !
      queue !
      splitmuxsink location=/tmp/people-output.mp4
      t0. !
      queue !
      vah264dec !
      video/x-raw(memory:VAMemory) !
      gvafpscounter starting-frame=100 !
      gvadetect
        model=/models/output/pipeline-zoo-models/yolov5s-416_INT8/FP16-INT8/yolov5s.xml
        model-proc=/models/output/pipeline-zoo-models/yolov5s-416_INT8/yolo-v5.json
        model-instance-id=detect0-gpu-npu
        pre-process-backend=va-surface-sharing
        device=GPU
        batch-size=0
        inference-interval=3
        nireq=0 !
      queue !
      gvatrack tracking-type=short-term-imageless !
      queue !
      gvaclassify
        model=/models/output/pipeline-zoo-models/resnet-50-tf_INT8/resnet-50-tf_i8.xml
        model-proc=/models/output/pipeline-zoo-models/resnet-50-tf_INT8/resnet-50-tf_i8.json
        model-instance-id=classify0-gpu-npu
        pre-process-backend=va
        device=NPU
        batch-size=0
        inference-interval=3
        nireq=0
        inference-region=roi-list
        reclassify-interval=1 !
      queue !
      gvawatermark !
      gvametaconvert format=json json-indent=4 !
      gvametapublish method=file file-path=/dev/null !
      vapostproc !
      video/x-raw(memory:VAMemory),width=320,height=240 !
      fakesink name=default_output_sink
