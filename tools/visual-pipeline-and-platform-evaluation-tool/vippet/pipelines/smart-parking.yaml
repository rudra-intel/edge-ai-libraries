# Reference: This is the official reference for Smart Parking pipeline
# https://github.com/open-edge-platform/edge-ai-suites/tree/main/metro-ai-suite/metro-vision-ai-app-recipe/smart-parking
name: Smart Parking
definition: >
  Smart Parking is a cloud-native, microservices-based video analytics pipeline that uses pre-trained deep learning models to detect parking-space occupancy.
tags:
  - Smart Cities
thumbnail: images/smart-parking.png
variants:
  - name: CPU
    pipeline_description: >-
      filesrc location=/videos/input/metro_smart_parking.mp4 !
      decodebin3 !
      gvadetect
        model=/models/output/public/yolo11s/FP16/yolo11s.xml
        pre-process-backend=opencv
        device=CPU
        threshold=0.7
        inference-interval=1
        inference-region=full-frame
        model-instance-id=inst0-cpu !
      queue !
      gvaclassify
        model=/models/output/public/colorcls2/colorcls2.xml
        pre-process-backend=opencv
        device=CPU
        inference-interval=1
        model-instance-id=inst1-cpu
        inference-region=roi-list !
      queue !
      gvawatermark !
      gvametaconvert add-empty-results=true !
      queue !
      gvafpscounter starting-frame=100 !
      fakesink name=default_output_sink
  - name: GPU
    pipeline_description: >-
      filesrc location=/videos/input/metro_smart_parking.mp4 !
      decodebin3 !
      gvadetect
        model=/models/output/public/yolo11s/FP16/yolo11s.xml
        pre-process-backend=va-surface-sharing
        device=GPU
        batch_size=8
        inference-region=full-frame
        inference-interval=1
        nireq=2
        threshold=0.7
        model-instance-id=instgpu0 !
      queue !
      gvaclassify
        batch-size=8
        model=/models/output/public/colorcls2/colorcls2.xml
        pre-process-backend=va-surface-sharing
        device=GPU
        inference-interval=1
        inference-region=roi-list
        nireq=2
        model-instance-id=instgpu1 !
      queue !
      gvawatermark !
      gvametaconvert add-empty-results=true !
      queue !
      gvafpscounter starting-frame=100 !
      fakesink name=default_output_sink
  - name: NPU
    pipeline_description: >-
      filesrc location=/videos/input/metro_smart_parking.mp4 !
      decodebin3 !
      gvadetect
        model=/models/output/public/yolo11s/FP16/yolo11s.xml
        pre-process-backend=va
        device=NPU
        batch_size=1
        inference-interval=1
        inference-region=full-frame
        nireq=2
        threshold=0.7
        model-instance-id=instnpu0 !
      queue !
      gvaclassify
        model=/models/output/public/colorcls2/colorcls2.xml
        pre-process-backend=va
        device=NPU
        inference-interval=1
        inference-region=roi-list
        batch-size=1
        nireq=2
        model-instance-id=instnpu1 !
      queue !
      gvawatermark !
      gvametaconvert add-empty-results=true !
      queue !
      gvafpscounter starting-frame=100 !
      fakesink name=default_output_sink
  - name: GPU_NPU
    pipeline_description: >-
      filesrc location=/videos/input/metro_smart_parking.mp4 !
      decodebin3 !
      gvadetect
        model=/models/output/public/yolo11s/FP16/yolo11s.xml
        pre-process-backend=va-surface-sharing
        device=GPU
        batch_size=8
        inference-region=full-frame
        inference-interval=1
        nireq=2
        threshold=0.7
        model-instance-id=instgpu-npu0 !
      queue !
      gvaclassify
        model=/models/output/public/colorcls2/colorcls2.xml
        pre-process-backend=va
        device=NPU
        inference-interval=1
        inference-region=roi-list
        batch-size=1
        nireq=2
        model-instance-id=instgpu-npu1 !
      queue !
      gvawatermark !
      gvametaconvert add-empty-results=true !
      queue !
      gvafpscounter starting-frame=100 !
      fakesink name=default_output_sink
